<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
  </head>

  <body>
    <style>
      html {
        --lumo-primary-text-color: rgb(97, 34, 109);
        --lumo-primary-color-50pct: rgba(97, 34, 109, 0.5);
        --lumo-primary-color-10pct: rgba(97, 34, 109, 0.1);
        --lumo-primary-color: #61226d;
        --lumo-error-text-color: rgb(228, 73, 101);
        --lumo-error-color-50pct: rgba(228, 73, 101, 0.5);
        --lumo-error-color-10pct: rgba(228, 73, 101, 0.1);
        --lumo-error-color: #e44965;
        --lumo-success-text-color: rgb(25, 190, 129);
        --lumo-success-color-50pct: rgba(25, 190, 129, 0.5);
        --lumo-success-color-10pct: rgba(25, 190, 129, 0.1);
        --lumo-success-color: #19be81;
      }

      body {
        margin: 0;
      }

      @media screen and (min-width: 1024px) {
        html {
          background: black;
        }
        .main {
          position: fixed;
          top: 0;
          right: 0;
          bottom: 0;
          left: 0;
        }

        .nav {
          position: absolute;
          top: 0;
          bottom: 0;
          left: 0;
          width: 72px;
          background: #61226d;
        }

        .aside {
          position: absolute;
          top: 0;
          bottom: 0;
          left: 72px;
          width: 320px;
          background: #61226d;
          opacity: 0.75;
        }

        .demo {
          position: absolute;
          top: 0;
          right: 0;
          bottom: 0;
          left: 392px;
          overflow: auto;
          background: white;
        }

        .demo > * {
          max-width: 800px;
        }
      }
    </style>

    <script>
      /* Trick XState into thinking it runs in Node */
      window.process = { env: {} };
    </script>

    <div class="main">
      <div class="nav"></div>
      <div class="aside"></div>
      <div class="demo">
        <div id="demo"></div>
      </div>
    </div>

    <script type="module">
      /* eslint-disable @typescript-eslint/camelcase */
      import { QuickCheckout } from '/dist/index.js';

      customElements.define('quick-checkout', QuickCheckout);

      /* Respond with 200 OK and request body to any request */
      function emulateRequest({ detail }) {
        detail.intercept(async (url, { body }) => {
          await new Promise(res => setTimeout(res, 1000));
          return new Response(body);
        });
      }

      const demoResource = {
        _links: {
          self: {
            href: 'https://foxy.io/s/admin/stores/8/customer_portal_settings',
          },
        },

        sso: true,
        date_created: new Date().toISOString(),
        date_modified: new Date().toISOString(),
        jwtSharedSecret: 'JWT-SHARED-SECRET-VALUE',
        sessionLifespanInMinutes: 10080,
        allowedOrigins: ['http://localhost:8000', 'https://foxy.io'],

        subscriptions: {
          allowFrequencyModification: {
            jsonataQuery: '$contains(frequency, "w")',
            values: ['2w', '4w', '6w'],
          },
          allowNextDateModification: [
            {
              min: '2w',
              max: '6w',
              jsonataQuery: '$contains(frequency, "w")',
              disallowedDates: [new Date().toISOString()],
              allowedDays: {
                type: 'month',
                days: [1, 2, 3, 14, 15, 16],
              },
            },
          ],
        },
      };

      const element = new QuickCheckout();
      element.products = [
        {
          "name": "Happy Teddy",
          "price": 101.2,
          "image": "http://res.publicdomainfiles.com/pdf_view/187/14008084213141.jpg",
          "alt": "A Teddy Bear with long arms, behind a window glass, in a grayscale picture. A pictkre by George Hodan"
        },
        {
          "name": "Cool product",
          "price": 100.2,
          "image": "http://res.publicdomainfiles.com/pdf_view/52/13525935018166.png",
          "alt": "A drawing of a Little Mouse, by Rasmussen, featuring a white mouse that looks like a toy with yellow shirt and red pants"
        }
      ];

      element.service.state.context = demoResource;
      element.requestUpdate();
      element.addEventListener('request', emulateRequest);

      document.querySelector('#demo').append(element);
    </script>
  </body>
</html>
